function suppressed_R = nonmax_suppression(filtered_R, Eo)

D = [0, pi/4, pi/2, 3*pi/4];
theta_Eo = atan(Eo);
theta_Eo(theta_Eo < 0) = theta_Eo(theta_Eo < 0) + pi;

[row, col, max] = size(filtered_R);


for i = 2 : row - 1
    for j = 2 : col - 1
        for k = 1 : max
            if filtered_R(i, j, k) == 0
                continue;
            end
            min_diff = theta_Eo(i, j, k);
            min_theta = 0;
            
            for m = 1 : 4
                if theta_Eo(i, j, k) - D(m) < min_diff
                    min_theta = D(m);
                end
            end
            % nonmax_suppression
            filtered_R = suppress(filtered_R, min_theta, i, j, k);
        end 
    end
end

suppressed_R = filtered_R;

end

function filtered_R = suppress(filtered_R, min_theta, i, j, k)

D = [0, pi/4, pi/2, 3*pi/4];
deltaX = [1, 1, 0, -1];
deltaY = [0, 1, 1, 1];
delta = [-2, -1, 1, 2];
neigh = zeros

for m = 1 : 4
    if min_theta == D(m)
        i_neigh1 = i + deltaX(m);
        j_neigh1 = j + deltaY(m);
        i_neigh2 = i - deltaX(m);
        j_neigh2 = j - deltaY(m);
        break;
    end
end

if filtered_R(i_neigh1, j_neigh1, k) > filtered_R(i, j, k) || filtered_R(i_neigh2, j_neigh2, k) > filtered_R(i, j, k)
    filtered_R(i, j, k) = 0;
end


end